<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Pegof online</title>
        <link href="pegof.css" rel="stylesheet" />
    </head>
    <body>
        <h1>Pegof online</h1>
        <div id="controls">
            <div class="container">
                <h3>What is pegof?</h3>
                <div>
                    Pegof is a command-line tool to format and optimize <a href="https://en.wikipedia.org/wiki/Parsing_expression_grammar">PEG</a> grammars.
                    It supports any grammar supported by <a href="https://github.com/arithy/packcc">PackCC</a> parser generator.
                    You can learn more about it in its <a href="https://github.com/dolik-rce/pegof">GitHub repository</a>.
                </div>
                <h3>How does it work?</h3>
                <div>
                    Pegof parses peg grammar from input file and extracts it's <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">AST</a>.
                    Then, based on the command it either just prints it out in nice and consistent format or directly as AST.
                    It can also perform multi-pass optimization process that goes through the AST and tries to simplify
                    it as much as possible to reduce number of rules and terms, which results in faster code in the generated parser.
                </div>
                <h3>How to use this site?</h3>
                <div>
                    You can update the grammar in the input field and also the configuration on the right.
                    The output and log fields will be automatically updated, unless auto-update is turned off.
                    Note that this is just a demo, the real command-line tool provides more functionality,
                    that would be difficult to show in the web environment.
                </div>
            </div>
            <div class="container">
                <table>
                    <tr title="What output mode should be used">
                        <td>Output type:</td>
                        <td>
                            <select class="opt">
                                <option id="f" value="-f" selected data-default>PEG</option>
                                <option id="a" value="-a">AST</option>
                            </select>
                        </td>
                    </tr>
                    <tr title="Whether to write &quot;Generated by pegof&quot; header">
                        <td>Add header:</td>
                        <td>
                            <select class="opt">
                                <option id="h1" value="-H auto" selected data-default>Auto</option>
                                <option id="h2" value="-H always">Always</option>
                                <option id="h3" value="-H never">Never</option>
                            </select>
                        </td>
                    </tr>
                    <tr title="Switch between double and single quoted strings">
                        <td>Quotes:</td>
                        <td>
                            <select class="opt">
                                <option id="q1" value="-q double" selected data-default>double (")</option>
                                <option id="q2" value="-q single">single (')</option>
                            </select>
                        </td>
                    </tr>
                    <tr title="Wrap alternations with more than N sequences to separate lines">
                        <td>Wrap threshold:</td>
                        <td><input id="w" class="opt" type="number" data-opt="-w" data-default="1" value="1" min="1"></input></td>
                    <tr>
                        <td colspan=2>
                            <hr>
                        </td>
                    </tr>
                    <tr title="Verbose logging to stderr">
                        <td>Verbosity:</td>
                        <td>
                            <select class="opt">
                                <option id="v0" value="">Errors only</option>
                                <option id="v1" value="-v" selected data-default>Low</option>
                                <option id="v2" value="-v -v">More</option>
                                <option id="v3" value="-v -v -v">Even more</option>
                                <option id="v4" value="-v -v -v -v">Highest</option>
                            </select>
                        </td>
                    </tr>
                    <tr title="Output very verbose debug info, implies max verbosity">
                        <td>Debug:</td>
                        <td><input id="d" class="opt" type="checkbox" data-default="0" value="-d"></input></td>
                    </tr>
                    <tr title="Skip result validation (useful probably only for debugging purposes)">
                        <td>Skip validation:</td>
                        <td><input id="s" class="opt" type="checkbox" data-default="0" value="-S"></input><br></td>
                    </tr>
                    <tr>
                        <td colspan=2>
                            <hr>
                        </td>
                    </tr>
                    <tr title="Minimum inlining score needed for rule to be inlined, value in range 0..1, only applied when inlining is enabled">
                        <td>Inline limit:</td>
                        <td><input id="l" class="opt" type="number" data-opt="-l" data-default="0.2" value="0.2" min="0" max="1" step="0.1"></input></td>
                    </tr>
                </table>
            </div>
            <div class="container">
                Optimizations:<br>
                <select multiple size=13 class="opt" id="optimizations" title="Select optimizations to use. Multiple items can be selected by Ctrl + click.">
                    <option id="x0" value="-O none" selected data-default>None</option>
                    <option id="x1" value="-O all">All</option>
                    <option id="x2" value="-O concat-char-classes">Character class concatenation</option>
                    <option id="x3" value="-O concat-strings">String concatenation</option>
                    <option id="x4" value="-O double-negation">Removing double negations</option>
                    <option id="x5" value="-O double-quantification">Removing double quantifications</option>
                    <option id="x6" value="-O inline">Rule inlining</option>
                    <option id="x7" value="-O normalize-char-class">Character class optimization</option>
                    <option id="x8" value="-O remove-group">Remove unnecessary groups</option>
                    <option id="x9" value="-O repeats">Removing unnecessary repeats</option>
                    <option id="x10" value="-O single-char-class">Convert single character classes to strings</option>
                    <option id="x11" value="-O unused-capture">Removing unused captures</option>
                    <option id="x12" value="-O unused-variable">Removing unused variables</option>
                </select>
            </div>
            <div class="container">
                <label title="List of optimizations to apply">
                    Load grammar:<br>
                    <select id="load">
                        <option id="p0" value="simple.peg" selected data-default>Simple</option>
                        <option id="p1" value="json.peg">JSON</option>
                        <option id="p2" value="calc.peg">Calc</option>
                        <option id="p3" value="c.peg">C</option>
                    </select>
                </label>
                <hr>
                <label title="List of optimizations to apply">
                    Auto-update:
                    <input id="u" type="checkbox" data-default="1" checked></input>
                </label>
                <button disabled id="btnRun">Loading...</button>
            </div>
        </div>
        <div class="main">
            <h3>Input:</h3>
            <textarea id="input" title="Modify the grammar as you wish. Ctrl+Enter can be used to process it immediately."></textarea>
        </div>
        <div class="main">
            <h3>Output:</h3>
            <pre id="output"></pre>
        </div>
        <div class="main">
            <h3>Log:</h3>
            <pre id="log"></pre>
        </div>
        <script src="glue.js"></script>
        <script src="pegof.js"></script>
    </body>
</html>
